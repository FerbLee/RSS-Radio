{% extends 'base.html' %}
{% load i18n %}
{% block content %}

{% trans "See more" as seemore %}

<h3> <img src="{{ episode.program.image.path.url }}" width='50'> {% trans "Program:" %} 
	<a href="{% url 'rss_feed:detail_program' episode.program.id %}"> {{ episode.program.name }}</a></h3>
<h1> <img src="{{ episode.image.path.url }}" width='100'> {% trans "Episode:" %} {{ episode.title }}</h1>

{% if request.user.is_authenticated %}
	<div id="like-buttons">
	
		{% if user_vote_type == like_type  %}
	
			<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id neutral_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-success" value="{% blocktrans %}Liked{% endblocktrans %}">
	 		</form>
	 		<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id dislike_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-default" value="{% blocktrans %}Dislike{% endblocktrans %}" >
	 		</form> 
	
		{% else %} {% if user_vote_type == dislike_type %}
	
			<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id like_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-default" value="{% blocktrans %}Like{% endblocktrans %}">
	 		</form>
	 		<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id neutral_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-failure" value="{% blocktrans %}Disliked{% endblocktrans %}" >
	 		</form> 
	
		{% else %}
	
			<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id like_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-default" value="{% blocktrans %}Like{% endblocktrans %}">
	 		</form>
			
	 		<form method="post" class="form-inline" action="{% url 'rss_feed:vote_episode' episode.id dislike_type %}" >
	 			{% csrf_token %}
	 	 		<input type="submit" class="btn btn-default" value="{% blocktrans %}Dislike{% endblocktrans %}" >
	 		</form> 
	 	{% endif %}
	 	{% endif %}	

	</div>
{% endif %}

<p><b>{% trans "Likes:" %}</b> {{ upvotes }} 
	<b>{% trans "Dislikes:" %}</b> {{ downvotes}}
	<b>{% trans "Downloads:" %}</b> {{ episode.downloads }}</p>
<p><b>{% trans "Published on:" %}</b> {{ episode.publication_date }}</p>

<audio controls>
	<source src="{{ episode.file }}" type="{{ episode.file_type }}"/>
	{% trans "Your browser does not support the audio element." %}
</audio>

<p><b>{% trans "Categories:" %}</b> 
	{% for category in program.tag_set.all %}
		<a href="{% url 'rss_feed:unknown' %}"> {{ category }}</a> 
	{% endfor %}
</p>

<p><b>{% trans "Summary:" %}</b> {{ episode.summary|safe }} </b></p>

<div class='comment-section'>

	{% if episode.comment_set.all %}
		<p><b>{% trans "Comments:" %}</b></b></p>

		{% for comment in episode.comment_set.all %}
			<div class="single-comment">
				
				<p><a href="{% url 'rss_feed:detail_user' comment.user.id %}">
					<img src="{{ comment.user.userprofile.avatar.path.url }}" width='50'/> 
					{{comment.user.username}} </a> {% trans "at" %} {{comment.publication_date}}</p>
				
				{{comment.text}}
			
			</div>
		
		{% endfor %}
	
	{% else %}
	
		<p><b>{% trans "No comments yet" %}</b></b></p>
	
	{% endif %}
	
	{% if request.user.is_authenticated %}
		
		{% if comment_form %}
			
			<form method="post" action='' enctype='multipart/form-data' >
				<p><b>{% trans "Leave a comment" %}</b></p>
				{% csrf_token %}
				
				{% for field in comment_form %}
		        	{{ field }}
		        	{% if field.help_text %}
		          		<small style="color: grey">{{ field.help_text }}</small>
		        	{% endif %}
	        		{% for error in field.errors %}
	          			<p style="color: red">{{ error }}</p>
	        		{% endfor %}
				{% endfor %}
				<button type="submit">{% trans "Publish" %}</button> 
			</form>
			
		{% endif %}
	
	{% endif %}
	
		
</div>
<p><a href="{% url 'rss_feed:index'%}">{% trans "Back" %}</a></p>
{% endblock %}
